# Epic 2 Retrospective: Property Data Acquisition

**Date:** 2025-12-05
**Facilitator:** Bob (Scrum Master)
**Participant:** Andrew (Project Lead)
**Epic Status:** COMPLETE (7/7 stories)

---

## Executive Summary

Epic 2 delivered the complete property data acquisition layer with all 7 stories completed, 182+ tests, and 5 extractors built. The retrospective identified significant wins in content-addressed storage architecture and parallel API development, while surfacing critical insights about live testing requirements and agent orchestration patterns.

**Key Outcome:** Live extraction validation required before Epic 3; orchestration metadata to be added to story/epic templates.

---

## Epic 2 Delivery Metrics

| Metric | Value |
|--------|-------|
| Stories Completed | 7/7 (100%) |
| Total Tests | 182+ |
| Extractors Built | 5 (Zillow, Redfin, County, Google, Schools) |
| Critical Bugs Fixed | 9 (E2.S4 content-addressed storage) |
| PRD Coverage | FR1-6, FR58-62 |
| Active Blockers | 2 (BLOCK-001, BLOCK-002 - pending validation) |

### Test Coverage by Story

| Story | Tests | Focus |
|-------|-------|-------|
| E2.S1 | 37 | CLI flags, CSV validation |
| E2.S2 | 25 | Live County API integration |
| E2.S3 | 18 | Stealth browser, fallbacks |
| E2.S4 | 25 | Content-addressed storage |
| E2.S5-S7 | 72 | API track (shared) |

---

## What Went Well

### Wins

| Category | Finding | Impact |
|----------|---------|--------|
| **Content-Addressed Storage** | E2.S4 delivered production-grade manifest system with lineage tracking | HIGH |
| **APIClient Base Class** | E2.S7 enabled rapid parallel development of 3 API integrations | HIGH |
| **Live Testing Approach** | Discovered real-world issues (BLOCK-001/002) that mocks missed | HIGH |
| **Bug Fix Discipline** | 9 critical bugs fixed proactively in E2.S4 rather than shipping fragile code | HIGH |
| **User-Agent Rotation** | 24 signatures across Chrome/Firefox/Safari/Edge | MEDIUM |

### Key Success Factors

1. **Parallel API Track**: E2.S5, S6, S7 executed concurrently, producing 72 tests
2. **Fallback Architecture**: nodriver → curl-cffi → Playwright MCP chain provides resilience
3. **Emergent Complexity Handled Well**: E2.S4 scope grew but team responded with quality fixes

---

## What Could Be Improved

### Challenges Identified

| Category | Challenge | Root Cause |
|----------|-----------|------------|
| **Anti-Bot Detection** | 67% Zillow extraction failure rate | PerimeterX CAPTCHA updates |
| **Mock Testing Gap** | BLOCK-001/002 only discovered in live testing | Over-reliance on mocks |
| **Orchestration Undocumented** | Parallel execution decisions not captured in stories | No template field |
| **Emergent Complexity** | E2.S4 grew from simple caching to 9 bug fixes | Original design assumptions insufficient |

### Blockers Discovered

| ID | Severity | Issue | Status |
|----|----------|-------|--------|
| BLOCK-001 | Critical | Zillow CAPTCHA (PerimeterX px-captcha) | Pending validation |
| BLOCK-002 | High | Redfin CDN 404 (session-bound URLs) | Pending validation |

---

## Previous Retrospective Follow-Through (Epic 1)

| # | Action Item | Status | Evidence |
|---|-------------|--------|----------|
| A1 | Fix 600 vs 605 scoring | ✅ Completed | Code correct, docs updated |
| A2-A4 | HARD kill-switch reclassification | ✅ Completed | buyer_criteria.yaml updated |
| A5 | Resolve 12 code review issues | ✅ Completed | Fixed in commit 9b8236e |
| A6 | Create test fixtures | ⏳ Partial | Some stories, not all |
| A7 | Live-data integration test requirements | ⏳ Partial | Inconsistent across stories |
| A8 | Unit tests for infrastructure | ⏳ In Progress | 33 untested files remain |
| A9 | AI-assisted output validation | ❌ Not Started | Deferred |
| A10 | Document parallelization patterns | ✅ Completed | Epic 2 used parallel track |

**Summary:** 5 completed, 3 in progress, 2 not addressed

---

## Key Lessons Learned

| # | Lesson | Category | Action |
|---|--------|----------|--------|
| L1 | Live testing is essential - mocks create false confidence | Process | Require live validation in all stories |
| L2 | Emergent complexity is normal - respond well to it | Mindset | Accept discovery, fix proactively |
| L3 | Orchestration patterns need documentation per-story and per-epic | Process | Add template fields |
| L4 | Validate before assuming - check blocker status before planning remediation | Process | Evidence-based planning |

---

## Action Items

### Process Improvements

| # | Action | Owner | Deadline | Success Criteria |
|---|--------|-------|----------|------------------|
| A1 | Add orchestration metadata to story template | SM | Before E3.S1 | Template updated |
| A2 | Add wave planning section to epic template | SM | Before E3 | Epic 3 has orchestration plan |
| A3 | Require live validation step in all stories | SM | Ongoing | Added to Definition of Done |

### Technical / Blockers

| # | Action | Owner | Priority | Success Criteria |
|---|--------|-------|----------|------------------|
| A4 | Run live extraction validation (5 properties) | Dev Team | CRITICAL | Document success rate |
| A5 | IF <80%: Remediate BLOCK-001 (zpid URLs) | Dev Team | HIGH | >80% Zillow success |
| A6 | IF <80%: Remediate BLOCK-002 (session download) | Dev Team | HIGH | >80% Redfin success |
| A7 | Update sprint-status.yaml blocker section | Dev Team | HIGH | Accurate status |

### Documentation

| # | Action | Owner | Deadline | Success Criteria |
|---|--------|-------|----------|------------------|
| A8 | Document Epic 2 orchestration patterns | SM | Before E3 | Patterns captured |
| A9 | Add orchestration protocols reference to story template | SM | Before E3.S1 | Template links to docs |

### Team Agreements

| # | Agreement | Rationale |
|---|-----------|-----------|
| TA1 | Live testing is mandatory, not optional | Mocks create false confidence |
| TA2 | Emergent complexity is expected - respond well | E2.S4 proved this works |
| TA3 | Orchestration plans documented per-epic | Enables parallel execution |
| TA4 | Validate blockers before assuming remediation needed | Evidence over assumptions |

---

## Epic 3 Preparation

### Critical Path

| # | Task | Owner | Est. | Success Criteria |
|---|------|-------|------|------------------|
| P1 | Run live extraction validation (5 properties) | Dev Team | 1 hr | Results documented |
| P2 | Update blocker status in sprint-status.yaml | Dev Team | 0.5 hr | Accurate status |
| P3 | Add orchestration wave plan to Epic 3 file | SM | 2 hr | Waves 1-3 defined |

### Proposed Epic 3 Orchestration

```
Wave 0: BLOCKER REMEDIATION [Conditional - Before Epic]
  - Validate BLOCK-001/002 status
  - Remediate if needed

Wave 1: FOUNDATION [Sequential]
  - E3.S1: HARD Kill-Switch Criteria
  - Model: Sonnet
  - Dependencies: E1.S1, E2 data sources

Wave 2: EXTENSIONS [Parallel]
  - E3.S2: SOFT Severity System | Model: Sonnet
  - E3.S3: Verdict Evaluation | Model: Sonnet
  - Conflicts: None

Wave 3: PRESENTATION [Parallel]
  - E3.S4: Failure Explanations | Model: Haiku
  - E3.S5: Config Management | Model: Sonnet
  - Conflicts: None
```

---

## Readiness Assessment

| Dimension | Status | Notes |
|-----------|--------|-------|
| Testing & Quality | ✅ HIGH | 182+ tests, all green |
| Deployment | ✅ COMPLETE | Merged to master, CLI functional |
| Stakeholder Acceptance | ✅ ACCEPTED | Andrew approved |
| Technical Health | ✅ STABLE | E2.S4 improvements, no incidents |
| Unresolved Blockers | ⚠️ PENDING | BLOCK-001/002 need live validation |

---

## Next Steps

1. **Run live extraction validation (P1)** - Determines blocker status
2. **Update sprint-status.yaml (P2)** - Reflect current state
3. **Add orchestration wave plan to Epic 3 (P3)** - Enable parallel execution
4. **Begin Epic 3** - When preparation complete

---

## Metrics Summary

| Metric | Value |
|--------|-------|
| Stories Completed | 7/7 (100%) |
| Tests Added | 182+ |
| Action Items | 9 |
| Preparation Tasks | 8 |
| Team Agreements | 4 |
| Key Lessons | 4 |

---

*Generated: 2025-12-05*
*Workflow: BMAD Retrospective v6.0.0-alpha.13*
