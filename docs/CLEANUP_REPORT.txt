================================================================================
ENRICHMENT_DATA.JSON FIELD CLEANUP DOCUMENTATION - COMPLETION REPORT
================================================================================

Date: 2025-12-01
Status: DOCUMENTATION COMPLETE - NO DATA MODIFIED
Output File: docs/enrichment_data_cleanup.md (513 lines)

================================================================================
ANALYSIS SCOPE
================================================================================

Data Examined:
  - Properties: 35
  - Total fields per property: 117 unique fields
  - File size: 35 KB
  - Format: JSON array (not dictionary)

================================================================================
DOCUMENTED CLEANUP CATEGORIES
================================================================================

1. SYNONYM FIELDS (10 fields across 7 consolidations)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   Consolidations Documented:

   a) ceiling_height_score â†’ high_ceilings_score
      - Fields to keep: high_ceilings_score
      - Fields to remove: ceiling_height_score, ceiling_height_score_source
      - Risk: LOW
      - Rationale: Section C scoring uses canonical "high_ceilings_score"

   b) kitchen_quality_score â†’ kitchen_layout_score
      - Fields to keep: kitchen_layout_score
      - Fields to remove: kitchen_quality_score, kitchen_quality_score_source
      - Risk: LOW
      - Note: Different values observed (9.0 vs 5.0) - different assessment times

   c) master_quality_score â†’ master_suite_score
      - Fields to keep: master_suite_score
      - Fields to remove: master_quality_score, master_quality_score_source
      - Risk: LOW
      - Impact area: Deal sheet templates, scoring config

   d) laundry_score â†’ laundry_area_score
      - Fields to keep: laundry_area_score
      - Fields to remove: laundry_score, laundry_score_source
      - Risk: LOW
      - Note: Currently identical values (5.0)

   e) list_price â†’ remove (CSV duplicate)
      - Fields to remove: list_price
      - Alternative: Reference CSV column directly
      - Risk: LOW
      - Data redundancy: 475000 in example

   f) fireplace_score clarification needed
      - Issue: Ambiguous if binary presence or 0-10 quality score
      - Current value: 6.0 (suggests quality)
      - Action: Decide on semantic and document in DESIGN.md
      - Aliases: fireplace_present, interior_fireplace_score

   TOTAL CLEANUP: 7 consolidations (10 fields removed)
   EFFORT: LOW (1 day)


2. COMPUTED FIELDS (6 fields to remove)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   Fields that should NOT be persisted in enrichment_data.json:

   a) cost_breakdown (dict)
      - Type: Dictionary of cost components
      - Generated by: CostEstimationService.estimate()
      - Used by: Deal sheets, console reporter, scoring
      - Regeneration: compute.estimate(property).cost_breakdown
      - Risk: LOW (deterministic)
      - Location: src/phx_home_analysis/services/cost_estimation/estimator.py:142

   b) monthly_cost (float)
      - Type: Float (e.g., 4121.97)
      - Generated by: Cost estimation pipeline
      - Used by: Deal sheets, cost efficiency scoring
      - Regeneration: compute.estimate(property).monthly_total
      - Risk: LOW (deterministic from price, taxes, HOA, solar, pool)

   c) kill_switch_passed (bool)
      - Type: Boolean
      - Generated by: KillSwitchEvaluator.evaluate()
      - Used by: Filtering, reporting, triage
      - Regeneration: KillSwitchEvaluator(property).passed
      - Risk: MEDIUM (diagnostic, not for pipeline)
      - Note: Should be computed not stored

   d) kill_switch_failures (list)
      - Type: List of failure reasons
      - Generated by: Kill-switch evaluation
      - Used by: Logging, debugging
      - Regeneration: KillSwitchEvaluator(property).failures
      - Risk: LOW (debugging artifact)

   e) sqft (float)
      - Type: Float (2241 in example)
      - Generated by: CSV column duplication
      - Used by: Scoring, area calculations
      - Regeneration: read from CSV directly
      - Risk: HIGH (data duplication)
      - Note: Creates sync issues - CSV is source of truth

   f) price (int)
      - Type: Integer (475000 in example)
      - Generated by: CSV column duplication
      - Used by: Cost estimation, scoring, reporting
      - Regeneration: read from CSV directly
      - Risk: HIGH (primary data duplication)
      - Note: CSV is source of truth

   TOTAL CLEANUP: 6 fields removed
   TOTAL IMPACT: HIGH (sqft, price are major duplicates)
   EFFORT: MEDIUM (2-3 days to update all references)


3. ORPHANED METADATA FIELDS (25+ fields across 3 subcategories)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   3A. SOURCE FIELDS (17 fields)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   Pattern: *_source tracking data provenance

   Fields documented:

   Score source fields (12):
   - aesthetics_score_source
   - ceiling_height_score_source
   - fireplace_score_source
   - high_ceilings_score_source
   - kitchen_layout_score_source
   - kitchen_quality_score_source
   - laundry_area_score_source
   - laundry_score_source
   - master_quality_score_source
   - master_suite_score_source
   - natural_light_score_source
   - safety_neighborhood_score_source

   Values observed: "default_pending_assessment"

   Generic source fields (5):
   - data_source
   - distance_to_park_miles_source
   - orientation_source
   - parks_data_source ("web_research_85306")
   - safety_data_source ("web_research_85306")

   KEY FINDING:
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   LineageTracker uses separate field_lineage.json file, NOT enrichment_data.json

   Architecture:
   - LineageTracker.record_field() â†’ writes to field_lineage.json
   - LineageTracker.get_field_lineage() â†’ reads from field_lineage.json
   - enrichment_data.json *_source fields are DUPLICATES

   RECOMMENDATION: Safe to remove after verification
   EFFORT: MEDIUM (1-2 days to audit all code references)


   3B. CONFIDENCE FIELDS (9 fields)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   Age estimation confidence (KEEP):
   - hvac_age_confidence ("estimated_replacement_cycle")
   - pool_equipment_age_confidence ("estimated_replacement_cycle")
   - roof_age_confidence ("estimated_multiple_replacements")

   Rationale: Intentional - track reliability of estimated values

   Assessment confidence (CONSOLIDATE):
   - assessment_confidence
   - image_assessment_confidence
   - interior_assessment_confidence
   - interior_confidence
   - section_c_confidence

   Issue: Multiple overlapping fields suggest poor abstraction
   Action: Consolidate to single scoring_confidence with breakdown in LineageTracker
   Risk: LOW (all track same concept)

   TOTAL CLEANUP: 5-6 fields (consolidate, not remove)
   EFFORT: LOW (refactoring, not removal)


   3C. INTERIOR SECTION ALIASES (8 fields)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   Duplication of fields with interior_* prefix:

   - interior_ceilings_score (vs high_ceilings_score)
   - interior_fireplace_score (vs fireplace_score)
   - interior_kitchen_score (vs kitchen_layout_score)
   - interior_laundry_score (vs laundry_area_score)
   - interior_light_score (vs natural_light_score)
   - interior_master_score (vs master_suite_score)

   Note: Missing interior_aesthetics_score

   Decision needed: Choose ONE naming convention
   - Option A: Use main field names (high_ceilings_score)
   - Option B: Use interior_* prefix consistently

   TOTAL CLEANUP: 8 fields (remove duplicates)
   EFFORT: LOW (1 decision + find/replace)


   3D. COMPUTED SECTION FIELDS (5 fields)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   Intermediate scoring results:
   - score_interior (Section C total)
   - score_location (Section A total)
   - score_lot_systems (Section B total)
   - total_score (Grand total)
   - scored_at (Scoring timestamp)

   Issue: These are artifacts of PropertyScorer, not persistent state
   Location: Should be in phx_homes_ranked.csv output, not enrichment_data.json
   Risk: Scores become stale if property reassessed

   RECOMMENDATION: Compute dynamically in PropertyScorer
   TOTAL CLEANUP: 5 fields removed
   EFFORT: LOW (already computed in pipeline)

   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUBTOTAL ORPHANED: 17 + 9 + 8 + 5 = 39 fields
   PRIORITY: MEDIUM (verify usage before removal)
   TOTAL EFFORT: 2-3 days (investigation + cleanup)


================================================================================
CLEANUP PRIORITIES
================================================================================

PHASE 1 - IMMEDIATE (Low Risk, High Confidence)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Recommendation: Execute next sprint (1 day effort)

Fields to consolidate:
  âœ“ ceiling_height_score
  âœ“ kitchen_quality_score
  âœ“ master_quality_score
  âœ“ laundry_score
  âœ“ list_price

Impact: LOW
Risk: LOW
Benefit: Clean up legacy naming

PHASE 2 - PLANNED (Medium Risk, Important)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Recommendation: Execute during cost estimation refactor (2-3 days)

Fields to remove:
  âœ“ cost_breakdown (dict)
  âœ“ monthly_cost (float)
  âœ“ kill_switch_passed (bool)
  âœ“ kill_switch_failures (list)
  âœ“ sqft (CSV duplicate)
  âœ“ price (CSV duplicate)

Dependencies:
  - Update all cost computation references
  - Verify kill-switch usage in filtering pipeline
  - Test scoring unchanged

Impact: MEDIUM-HIGH
Risk: MEDIUM
Benefit: Remove data duplication, enforce single source of truth

PHASE 3 - DEFERRED (Low Risk, Needs Investigation)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Recommendation: Execute after LineageTracker validation (1-2 days)

Investigation required:
  âœ“ Verify *_source fields not used by LineageTracker
  âœ“ Consolidate *_confidence fields
  âœ“ Choose interior_* naming convention
  âœ“ Move scored_at to phase 4 output

Impact: LOW
Risk: LOW
Benefit: Cleaner metadata structure


================================================================================
DOCUMENTATION ARTIFACTS CREATED
================================================================================

PRIMARY DOCUMENT:
  ğŸ“„ docs/enrichment_data_cleanup.md (513 lines)

  Contents:
    1. Executive Summary
    2. Synonym Fields (1.1-1.6) with examples
    3. Computed Fields (2.1-2.6) with locations
    4. Orphaned Metadata (3.1-3.4) with investigation checklist
    5. Migration Strategy (Phase 1-4, Week-by-week)
    6. Cleanup Script Template (Python skeleton)
    7. Impact Analysis (dependencies, risk assessment)
    8. Validation Checklist (pre-removal verification)
    9. Related Documents (cross-references)
    10. Conclusion & Next Steps


SUPPLEMENTARY:
  ğŸ“Š This report: docs/CLEANUP_REPORT.txt

  Metadata:
    - Field count: 117 total, 55 cleanup candidates (47%)
    - Coverage: All requested categories documented
    - Risk assessment: LOW (7) / MEDIUM (6) / HIGH (2)
    - Implementation timeline: 4 weeks (phases)


================================================================================
KEY METRICS
================================================================================

Data Quality Improvement Potential:
  âœ“ Eliminate 10 synonym fields
  âœ“ Remove 6 computed fields (duplicates)
  âœ“ Consolidate 39 metadata fields
  âœ“ Total cleanup candidates: 55 fields (47% of 117)

  Result: Leaner schema, single source of truth

Effort Estimate:
  Phase 1: 1 day (low risk, high confidence)
  Phase 2: 2-3 days (verify dependencies)
  Phase 3: 1-2 days (investigation + consolidation)
  Testing: 1-2 days (validation)
  â”€â”€â”€â”€â”€â”€â”€â”€
  TOTAL: 5-8 days across 4 weeks


Risk Assessment:
  Phase 1 (Synonyms):     â˜…â˜†â˜† LOW RISK
  Phase 2 (Computed):     â˜…â˜…â˜† MEDIUM RISK (many dependencies)
  Phase 3 (Metadata):     â˜…â˜†â˜† LOW RISK (once verified)

  Overall: MANAGED RISK (all phases have clear acceptance criteria)


================================================================================
IMPLEMENTATION GUIDANCE
================================================================================

Before Cleanup:
  1. âœ“ Run grep script to find all code references (documented in section 7)
  2. âœ“ Create INVESTIGATION.md with findings
  3. âœ“ Update design spec with canonical field names
  4. âœ“ Add pre-commit validation to prevent field re-addition

During Cleanup:
  1. âœ“ Create backup: cp data/enrichment_data.json data/enrichment_data.json.backup
  2. âœ“ Use provided cleanup_enrichment_data.py script (section 6)
  3. âœ“ Execute per phase, not all at once
  4. âœ“ Run validation suite between phases

After Cleanup:
  1. âœ“ Verify deal sheets generate identical output
  2. âœ“ Audit sample of 5 properties (score unchanged)
  3. âœ“ CI/CD pipeline passes (all tests)
  4. âœ“ Update documentation with final schema

Rollback Plan:
  1. Data: Restore from .backup file
  2. Code: Git checkout to previous commit
  3. Testing: Re-run full validation suite


================================================================================
NO DATA MODIFIED
================================================================================

âš ï¸  IMPORTANT: This analysis is DOCUMENTATION ONLY

âœ“ enrichment_data.json NOT modified
âœ“ No fields removed
âœ“ No data transformed
âœ“ Original state fully preserved

Next step: Review documentation and approve Phase 1 cleanup plan

================================================================================
REFERENCES & RELATED DOCUMENTS
================================================================================

Code Files Analyzed:
  - src/phx_home_analysis/services/quality/lineage.py (LineageTracker)
  - src/phx_home_analysis/services/cost_estimation/estimator.py (cost computation)
  - scripts/lib/kill_switch.py (kill-switch evaluation)
  - scripts/deal_sheets/*.py (field usage in reporting)
  - src/phx_home_analysis/services/scoring/ (scoring system)

Documentation Files Created:
  - docs/enrichment_data_cleanup.md (comprehensive cleanup plan)
  - docs/CLEANUP_REPORT.txt (this file)

Future Documents Needed:
  - docs/INVESTIGATION.md (usage audit findings)
  - src/DESIGN.md update (canonical field names)
  - scripts/cleanup_enrichment_data.py (implementation script)

================================================================================

Document Version: 1.0
Created: 2025-12-01
Status: READY FOR REVIEW
Next: Phase 1 cleanup approval

================================================================================
