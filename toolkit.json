{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Claude Code Toolkit Knowledge Graph",
  "description": "Comprehensive mapping of tools, skills, agents, and commands with relationships and common pitfalls",
  "version": "1.0.0",
  "generated": "2025-12-02",

  "tiers": {
    "tier_1": {
      "name": "Claude Native Tools",
      "priority": 1,
      "description": "Built-in Claude Code tools - ALWAYS prefer these over bash equivalents"
    },
    "tier_2": {
      "name": "Project CLI Scripts",
      "priority": 2,
      "description": "Python scripts in scripts/ directory"
    },
    "tier_3": {
      "name": "Skills",
      "priority": 3,
      "description": "Domain expertise modules in .claude/skills/"
    },
    "tier_4": {
      "name": "Subagents",
      "priority": 4,
      "description": "Specialized agents spawned via Task tool"
    },
    "tier_5": {
      "name": "Slash Commands",
      "priority": 5,
      "description": "Custom commands in .claude/commands/"
    },
    "tier_6": {
      "name": "MCP Tools",
      "priority": 6,
      "description": "External tool integrations (Playwright, Fetch)"
    }
  },

  "entities": [
    {
      "id": "read",
      "name": "Read",
      "type": "native_tool",
      "tier": 1,
      "description": "Read file contents with line numbers and offset/limit support",
      "parameters": ["file_path", "offset?", "limit?"],
      "allowed_behaviors": [
        "Read any file with absolute path",
        "Read images (PNG, JPG) visually",
        "Read PDFs with text/visual extraction",
        "Read Jupyter notebooks (.ipynb)",
        "Partial reads with offset/limit for large files"
      ],
      "disallowed_behaviors": [
        "Using bash cat/head/tail instead of Read",
        "Using relative paths (must be absolute)",
        "Reading directories (use Bash ls instead)"
      ],
      "replaces": ["cat", "head", "tail", "less"],
      "best_practices": [
        "ALWAYS use Read for file contents, never bash cat",
        "Use offset/limit for files >2000 lines",
        "Can read multiple files in parallel"
      ]
    },
    {
      "id": "write",
      "name": "Write",
      "type": "native_tool",
      "tier": 1,
      "description": "Write complete file contents (overwrites existing)",
      "parameters": ["file_path", "content"],
      "allowed_behaviors": [
        "Create new files",
        "Overwrite existing files (after reading first)",
        "Use absolute paths only"
      ],
      "disallowed_behaviors": [
        "Writing existing files without reading first",
        "Using bash echo/printf/cat instead of Write",
        "Using relative paths",
        "Proactively creating *.md documentation files"
      ],
      "replaces": ["echo >", "cat > EOF", "printf"],
      "best_practices": [
        "MUST Read file before Writing to it",
        "NEVER create docs unless explicitly requested",
        "Always prefer Edit over Write for existing files"
      ]
    },
    {
      "id": "edit",
      "name": "Edit",
      "type": "native_tool",
      "tier": 1,
      "description": "Perform exact string replacements in files",
      "parameters": ["file_path", "old_string", "new_string", "replace_all?"],
      "allowed_behaviors": [
        "Replace unique strings",
        "Rename variables with replace_all=true",
        "Preserve exact indentation from Read output"
      ],
      "disallowed_behaviors": [
        "Editing without reading file first",
        "Including line number prefix in old_string/new_string",
        "Using bash sed/awk instead of Edit",
        "Using non-unique old_string without replace_all"
      ],
      "replaces": ["sed", "awk", "perl -pie"],
      "best_practices": [
        "ALWAYS prefer editing existing files over creating new ones",
        "Preserve exact indentation after line number prefix",
        "Use replace_all for variable renaming across file"
      ]
    },
    {
      "id": "glob",
      "name": "Glob",
      "type": "native_tool",
      "tier": 1,
      "description": "Fast file pattern matching with glob patterns",
      "parameters": ["pattern", "path?"],
      "allowed_behaviors": [
        "Match patterns like **/*.js or src/**/*.ts",
        "Search from specified directory or cwd",
        "Returns sorted by modification time"
      ],
      "disallowed_behaviors": [
        "Using bash find instead of Glob",
        "Using bash ls for pattern matching",
        "Specifying 'undefined' or 'null' for path parameter"
      ],
      "replaces": ["find -name", "ls *.py"],
      "best_practices": [
        "ALWAYS use Glob for file search, never bash find",
        "Omit path parameter for cwd (don't pass 'undefined')",
        "Use for finding files by name patterns"
      ]
    },
    {
      "id": "grep",
      "name": "Grep",
      "type": "native_tool",
      "tier": 1,
      "description": "Powerful regex search built on ripgrep",
      "parameters": ["pattern", "path?", "output_mode?", "glob?", "type?", "-i?", "-n?", "-A?", "-B?", "-C?", "multiline?", "head_limit?", "offset?"],
      "allowed_behaviors": [
        "Full regex syntax (not grep-style)",
        "Filter by glob (*.js) or type (js, py, rust)",
        "Output modes: content, files_with_matches, count",
        "Context lines with -A/-B/-C",
        "Multiline patterns with multiline:true"
      ],
      "disallowed_behaviors": [
        "Using bash grep/rg instead of Grep tool",
        "Using grep-style patterns (need escaping for braces)",
        "Using bash find | grep pipelines"
      ],
      "replaces": ["grep", "rg", "find | grep"],
      "best_practices": [
        "ALWAYS use Grep tool, never bash grep/rg",
        "Escape literal braces: interface\\{\\} not interface{}",
        "Use multiline:true for cross-line patterns",
        "Use glob or type parameters for file filtering"
      ]
    },
    {
      "id": "bash",
      "name": "Bash",
      "type": "native_tool",
      "tier": 1,
      "description": "Execute bash commands for git, npm, docker, system operations",
      "parameters": ["command", "description", "timeout?", "run_in_background?"],
      "allowed_behaviors": [
        "Git operations (status, commit, push)",
        "Package managers (npm, pip, uv)",
        "Docker operations",
        "System commands (ls, pwd, env)",
        "Running Python scripts",
        "Chain commands with && or ;",
        "Background execution with run_in_background"
      ],
      "disallowed_behaviors": [
        "Using cat/head/tail (use Read)",
        "Using grep/rg (use Grep)",
        "Using find (use Glob)",
        "Using sed/awk (use Edit)",
        "Using echo for file I/O (use Write)",
        "Using cd extensively (prefer absolute paths)",
        "Git operations bypassing hooks (--no-verify)",
        "Force push to main/master"
      ],
      "not_for": ["file reading", "file searching", "content searching", "file editing"],
      "best_practices": [
        "Use for terminal operations only, not file I/O",
        "Always quote paths with spaces",
        "Use && to chain dependent commands",
        "Use ; only when you don't care if earlier commands fail",
        "Prefer absolute paths over cd",
        "Use uv instead of pip"
      ]
    },
    {
      "id": "task",
      "name": "Task",
      "type": "native_tool",
      "tier": 1,
      "description": "Spawn subagents for complex multi-step tasks",
      "parameters": ["agent", "prompt"],
      "allowed_behaviors": [
        "Spawn specialized agents for domain tasks",
        "Delegate complex multi-round searches",
        "Run parallel agent tasks"
      ],
      "disallowed_behaviors": [
        "Using Task for simple single-step operations",
        "Spawning agents for trivial tasks main agent can handle",
        "Spawning same agent that's already running"
      ],
      "spawns": ["listing-browser", "map-analyzer", "image-assessor"],
      "best_practices": [
        "Use for complex tasks requiring multiple rounds",
        "NOT for simple tasks main agent can do",
        "Check agent isn't already running before spawning"
      ]
    },
    {
      "id": "skill",
      "name": "Skill",
      "type": "native_tool",
      "tier": 1,
      "description": "Load domain expertise skill modules",
      "parameters": ["skill"],
      "allowed_behaviors": [
        "Load skills from .claude/skills/",
        "Load plugin skills",
        "Load managed skills"
      ],
      "disallowed_behaviors": [
        "Loading skill that's already loaded",
        "Loading non-existent skills"
      ],
      "provides_access_to": [
        "property-data",
        "state-management",
        "kill-switch",
        "scoring",
        "county-assessor",
        "arizona-context",
        "arizona-context-lite",
        "listing-extraction",
        "map-analysis",
        "image-assessment",
        "exterior-assessment",
        "inspection-standards",
        "deal-sheets",
        "visualizations",
        "cost-efficiency",
        "quality-metrics",
        "file-organization"
      ]
    },
    {
      "id": "websearch",
      "name": "WebSearch",
      "type": "native_tool",
      "tier": 1,
      "description": "Search the web for current information",
      "parameters": ["query", "allowed_domains?", "blocked_domains?"],
      "allowed_behaviors": [
        "Search for current events",
        "Look up recent documentation",
        "Domain filtering"
      ],
      "disallowed_behaviors": [
        "Forgetting to include Sources section in response",
        "Not listing URLs as markdown hyperlinks",
        "Using wrong year in queries (must use 2025 for current info)"
      ],
      "best_practices": [
        "MANDATORY: Include 'Sources:' section with markdown links",
        "Use correct year (2025) in search queries",
        "Filter domains when appropriate"
      ]
    },
    {
      "id": "webfetch",
      "name": "WebFetch",
      "type": "native_tool",
      "tier": 1,
      "description": "Fetch and process URL content",
      "parameters": ["url", "prompt"],
      "allowed_behaviors": [
        "Fetch HTML converted to markdown",
        "Process with AI model",
        "Follow redirects"
      ],
      "disallowed_behaviors": [
        "Using when mcp__fetch__fetch is available (prefer MCP)"
      ],
      "best_practices": [
        "Prefer mcp__fetch__fetch if available",
        "15-minute cache for repeated access"
      ]
    },
    {
      "id": "todowrite",
      "name": "TodoWrite",
      "type": "native_tool",
      "tier": 1,
      "description": "Track task progress for complex multi-step work",
      "parameters": ["todos"],
      "allowed_behaviors": [
        "Track 3+ step tasks",
        "Mark exactly ONE task as in_progress at a time",
        "Update status in real-time",
        "Complete tasks immediately after finishing"
      ],
      "disallowed_behaviors": [
        "Using for single straightforward tasks",
        "Using for trivial tasks",
        "Batching completions",
        "Having multiple in_progress tasks",
        "Marking incomplete tasks as completed"
      ],
      "best_practices": [
        "Use for complex multi-step tasks only",
        "Always provide both content and activeForm",
        "Keep exactly ONE task in_progress",
        "Only mark completed when FULLY accomplished"
      ]
    },

    {
      "id": "phx_home_analyzer",
      "name": "phx_home_analyzer.py",
      "type": "script",
      "tier": 2,
      "path": "scripts/phx_home_analyzer.py",
      "description": "Main analysis pipeline - loads listings, applies kill-switch, scores properties",
      "dependencies": ["property-data", "kill-switch", "scoring"],
      "provides": ["phx_homes_ranked.csv"],
      "usage": "python scripts/phx_home_analyzer.py"
    },
    {
      "id": "extract_images",
      "name": "extract_images.py",
      "type": "script",
      "tier": 2,
      "path": "scripts/extract_images.py",
      "description": "Image extraction orchestrator using stealth browsers (nodriver, curl_cffi)",
      "dependencies": ["listing-extraction", "state-management", "property-data"],
      "provides": ["downloaded images", "image_manifest.json", "extraction_state.json"],
      "usage": [
        "python scripts/extract_images.py --all",
        "python scripts/extract_images.py --address '123 Main St'",
        "python scripts/extract_images.py --sources zillow,redfin",
        "python scripts/extract_images.py --dry-run",
        "python scripts/extract_images.py --fresh",
        "python scripts/extract_images.py --resume"
      ]
    },
    {
      "id": "extract_county_data",
      "name": "extract_county_data.py",
      "type": "script",
      "tier": 2,
      "path": "scripts/extract_county_data.py",
      "description": "Extract property data from Maricopa County Assessor API",
      "dependencies": ["county-assessor", "property-data"],
      "provides": ["lot_sqft", "year_built", "garage_spaces", "has_pool", "livable_sqft"],
      "usage": "python scripts/extract_county_data.py --all --update-only",
      "requires_env": ["MARICOPA_ASSESSOR_TOKEN"]
    },
    {
      "id": "deal_sheets_generator",
      "name": "deal_sheets/generator.py",
      "type": "script",
      "tier": 2,
      "path": "scripts/deal_sheets/generator.py",
      "description": "Generate property deal sheets with scoring breakdowns",
      "dependencies": ["deal-sheets", "property-data", "scoring"],
      "provides": ["HTML deal sheets", "index.html"],
      "usage": [
        "python -m scripts.deal_sheets",
        "python scripts/deal_sheets/generator.py"
      ]
    },
    {
      "id": "generate_all_visualizations",
      "name": "generate_all_visualizations.py",
      "type": "script",
      "tier": 2,
      "path": "scripts/generate_all_visualizations.py",
      "description": "Generate all visualization maps and charts",
      "dependencies": ["visualizations", "property-data"],
      "provides": ["flood map", "crime heatmap", "golden zone map", "value spotter", "radar charts"],
      "usage": "python scripts/generate_all_visualizations.py"
    },
    {
      "id": "serve_reports",
      "name": "serve_reports.py",
      "type": "script",
      "tier": 2,
      "path": "scripts/serve_reports.py",
      "description": "Development server with auto-refresh on data changes",
      "dependencies": ["deal-sheets"],
      "provides": ["local web server", "auto-regeneration"],
      "usage": [
        "python scripts/serve_reports.py",
        "python scripts/serve_reports.py --no-regen",
        "python scripts/serve_reports.py --no-open",
        "python scripts/serve_reports.py --port 9000"
      ]
    },

    {
      "id": "skill_property_data",
      "name": "property-data",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/property-data",
      "description": "Load, query, update, and validate property data from CSV listings and JSON enrichment files",
      "allowed_tools": ["Read", "Write", "Bash(python:*)", "Grep"],
      "provides": [
        "Data loading patterns",
        "Pydantic validation layer",
        "PropertyValidator class",
        "Address normalization",
        "Type inference",
        "Data cache service",
        "Atomic write patterns"
      ],
      "used_by": ["listing-browser", "map-analyzer", "image-assessor"]
    },
    {
      "id": "skill_state_management",
      "name": "state-management",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/state-management",
      "description": "Pipeline state, checkpoints, and crash recovery via extraction_state.json",
      "provides": [
        "Triage logic",
        "State transitions",
        "Checkpoint patterns",
        "Retry handling",
        "Phase tracking"
      ],
      "used_by": ["listing-browser", "map-analyzer", "image-assessor"]
    },
    {
      "id": "skill_kill_switch",
      "name": "kill-switch",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/kill-switch",
      "description": "Evaluate buyer kill-switch criteria with weighted severity threshold system",
      "provides": [
        "HARD criteria validation (HOA, beds, baths)",
        "SOFT criteria severity scoring",
        "Verdict calculation (FAIL/WARNING/PASS)"
      ],
      "used_by": ["listing-browser", "phx_home_analyzer"]
    },
    {
      "id": "skill_scoring",
      "name": "scoring",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/scoring",
      "description": "Calculate property scores using 600-point weighted scoring system",
      "provides": [
        "Section A: Location (230pts)",
        "Section B: Lot/Systems (180pts)",
        "Section C: Interior (190pts)",
        "Tier assignments (Unicorn/Contender/Pass)",
        "Score breakdowns"
      ],
      "used_by": ["map-analyzer", "image-assessor", "phx_home_analyzer"]
    },
    {
      "id": "skill_county_assessor",
      "name": "county-assessor",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/county-assessor",
      "description": "Extract property data from Maricopa County Assessor API",
      "provides": [
        "Authoritative lot_sqft, year_built, garage_spaces",
        "Pool detection, livable_sqft",
        "Valuation data"
      ],
      "requires_env": ["MARICOPA_ASSESSOR_TOKEN"]
    },
    {
      "id": "skill_arizona_context",
      "name": "arizona-context",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/arizona-context",
      "description": "Arizona-specific real estate considerations (solar, pool, HVAC, climate)",
      "provides": [
        "Solar lease evaluation",
        "Pool economics ($100-150/mo + $3k-8k equipment)",
        "Sun orientation impacts",
        "HVAC lifespan (10-15yr in AZ vs 20+ elsewhere)"
      ],
      "used_by": ["map-analyzer", "image-assessor"]
    },
    {
      "id": "skill_arizona_context_lite",
      "name": "arizona-context-lite",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/arizona-context-lite",
      "description": "Lightweight AZ context for image assessment - pool/HVAC age estimation only",
      "provides": [
        "Pool equipment age estimation",
        "HVAC visual age calibration",
        "Era-based expectations"
      ],
      "used_by": ["image-assessor"]
    },
    {
      "id": "skill_listing_extraction",
      "name": "listing-extraction",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/listing-extraction",
      "description": "Extract property images and listing data from Zillow, Redfin, Realtor.com using stealth browsers",
      "provides": [
        "Stealth browser patterns (nodriver, curl_cffi)",
        "PerimeterX bypass strategies",
        "Anti-bot detection avoidance",
        "Session blocking protocol"
      ],
      "used_by": ["listing-browser"]
    },
    {
      "id": "skill_map_analysis",
      "name": "map-analysis",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/map-analysis",
      "description": "Analyze geographic data via Google Maps, GreatSchools, crime statistics, satellite imagery",
      "provides": [
        "School ratings",
        "Safety scoring",
        "Proximity calculations",
        "Orientation determination"
      ],
      "used_by": ["map-analyzer"]
    },
    {
      "id": "skill_image_assessment",
      "name": "image-assessment",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/image-assessment",
      "description": "Visually analyze property photos to score interior quality (Section C: 190pts)",
      "provides": [
        "Interior scoring rubrics",
        "Kitchen/master/light/ceiling/fireplace/laundry/aesthetics scoring",
        "Visual condition cues",
        "Era calibration",
        "Confidence level determination"
      ],
      "used_by": ["image-assessor"]
    },
    {
      "id": "skill_exterior_assessment",
      "name": "exterior-assessment",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/exterior-assessment",
      "description": "Visual assessment of roof, pool equipment, HVAC exterior condition",
      "provides": [
        "Roof visual condition protocols",
        "Pool equipment age estimation",
        "HVAC brand/age/refrigerant identification",
        "UAD condition mapping"
      ],
      "used_by": ["image-assessor"]
    },
    {
      "id": "skill_inspection_standards",
      "name": "inspection-standards",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/inspection-standards",
      "description": "UAD terminology and condition ratings (C1-C6 scale)",
      "provides": [
        "UAD condition ratings",
        "Inspector terminology",
        "Visual-to-rating mapping"
      ],
      "used_by": ["image-assessor"]
    },
    {
      "id": "skill_deal_sheets",
      "name": "deal-sheets",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/deal-sheets",
      "description": "Generate property deal sheets with kill-switch status, score breakdowns, tier classification",
      "provides": [
        "HTML deal sheet generation",
        "Score visualization",
        "Recommendation summaries"
      ]
    },
    {
      "id": "skill_visualizations",
      "name": "visualizations",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/visualizations",
      "description": "Generate property analysis visualizations",
      "provides": [
        "Radar charts",
        "Value spotter scatter plots",
        "Comparison charts",
        "Flood zone maps",
        "Crime heatmaps"
      ]
    },
    {
      "id": "skill_cost_efficiency",
      "name": "cost-efficiency",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/cost-efficiency",
      "description": "Estimate monthly housing costs for AZ properties",
      "provides": [
        "Mortgage calculation",
        "Taxes, insurance, utilities",
        "Pool maintenance costs",
        "Affordability projections"
      ]
    },
    {
      "id": "skill_quality_metrics",
      "name": "quality-metrics",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/quality-metrics",
      "description": "Track data quality, lineage, and CI/CD gates",
      "provides": [
        "Quality scoring",
        "Field provenance tracking",
        "Quality gate enforcement (95% threshold)"
      ]
    },
    {
      "id": "skill_file_organization",
      "name": "file-organization",
      "type": "skill",
      "tier": 3,
      "path": ".claude/skills/file-organization",
      "description": "Enforce proper file placement standards for project organization",
      "provides": [
        "Root directory policy (keep clean)",
        "File type destinations",
        "Organization rules"
      ]
    },

    {
      "id": "agent_listing_browser",
      "name": "listing-browser",
      "type": "agent",
      "tier": 4,
      "model": "haiku",
      "path": ".claude/agents/listing-browser.md",
      "description": "Browse real estate listing sites (Zillow, Redfin, Realtor.com) to extract property images and listing data",
      "skills": ["property-data", "state-management", "listing-extraction", "kill-switch"],
      "spawned_by": ["analyze-property"],
      "primary_tasks": [
        "Run stealth extractor (scripts/extract_images.py)",
        "Extract listing data (price, beds, baths, hoa_fee, description)",
        "Auto-download and deduplicate images",
        "Update state files"
      ],
      "must_extract": ["hoa_fee", "beds", "description"],
      "do_not_extract": ["lot_sqft", "year_built", "garage_spaces"]
    },
    {
      "id": "agent_map_analyzer",
      "name": "map-analyzer",
      "type": "agent",
      "tier": 4,
      "model": "haiku",
      "path": ".claude/agents/map-analyzer.md",
      "description": "Geographic analysis using Google Maps, GreatSchools, crime statistics, satellite imagery",
      "skills": ["property-data", "state-management", "map-analysis", "arizona-context", "scoring"],
      "spawned_by": ["analyze-property"],
      "primary_tasks": [
        "School ratings and district lookup",
        "Safety scoring from crime data",
        "Proximity calculations (grocery, highway, parks)",
        "Orientation determination from satellite"
      ]
    },
    {
      "id": "agent_image_assessor",
      "name": "image-assessor",
      "type": "agent",
      "tier": 4,
      "model": "sonnet",
      "path": ".claude/agents/image-assessor.md",
      "description": "Analyze property photos to assess exterior condition and score interior quality (Section C: 190pts)",
      "skills": ["property-data", "state-management", "image-assessment", "exterior-assessment", "inspection-standards", "arizona-context", "scoring"],
      "spawned_by": ["analyze-property"],
      "primary_tasks": [
        "Phase 2A: Exterior assessment (roof, pool, HVAC)",
        "Phase 2B: Interior scoring (7 categories, 190pts)",
        "Visual condition estimation",
        "Confidence level determination"
      ],
      "scoring_categories": [
        "Kitchen (40pts)",
        "Master Suite (40pts)",
        "Natural Light (30pts)",
        "High Ceilings (30pts)",
        "Fireplace (20pts)",
        "Laundry (20pts)",
        "Aesthetics (10pts)"
      ]
    },

    {
      "id": "cmd_analyze_property",
      "name": "/analyze-property",
      "type": "command",
      "tier": 5,
      "path": ".claude/commands/analyze-property.md",
      "description": "Multi-agent property analysis orchestrator with visual browsing",
      "usage": [
        "/analyze-property --test",
        "/analyze-property --all",
        "/analyze-property '123 Main St'",
        "/analyze-property --strict",
        "/analyze-property --skip-phase=1",
        "/analyze-property --resume",
        "/analyze-property --fresh"
      ],
      "spawns": ["listing-browser", "map-analyzer", "image-assessor"],
      "pipeline": [
        "Phase 0: County data extraction (authoritative)",
        "Phase 1: Listing + Map analysis (parallel agents)",
        "Phase 2: Image assessment (exterior + interior)",
        "Phase 3: Synthesis and scoring"
      ]
    },
    {
      "id": "cmd_commit",
      "name": "/commit",
      "type": "command",
      "tier": 5,
      "path": ".claude/commands/commit.md",
      "description": "Git commit helper with message generation",
      "usage": [
        "/commit",
        "/commit 'custom message'"
      ]
    },

    {
      "id": "mcp_playwright_navigate",
      "name": "mcp__playwright__browser_navigate",
      "type": "mcp_tool",
      "tier": 6,
      "description": "Navigate browser to URL using Playwright MCP",
      "parameters": ["url"],
      "limitations": [
        "DO NOT use for Zillow or Redfin (PerimeterX will block)",
        "OK for Realtor.com (lighter anti-bot)",
        "Prefer stealth browsers for anti-bot sites"
      ]
    },
    {
      "id": "mcp_playwright_snapshot",
      "name": "mcp__playwright__browser_snapshot",
      "type": "mcp_tool",
      "tier": 6,
      "description": "Capture accessibility snapshot of current page",
      "better_than": "mcp__playwright__browser_take_screenshot (for actions)"
    },
    {
      "id": "mcp_playwright_click",
      "name": "mcp__playwright__browser_click",
      "type": "mcp_tool",
      "tier": 6,
      "description": "Perform click on web page element",
      "parameters": ["element", "ref", "button?", "doubleClick?", "modifiers?"]
    },
    {
      "id": "mcp_playwright_type",
      "name": "mcp__playwright__browser_type",
      "type": "mcp_tool",
      "tier": 6,
      "description": "Type text into editable element",
      "parameters": ["element", "ref", "text", "slowly?", "submit?"]
    },
    {
      "id": "mcp_fetch",
      "name": "mcp__fetch__fetch",
      "type": "mcp_tool",
      "tier": 6,
      "description": "Fetch URL content as markdown",
      "parameters": ["url", "max_length?", "raw?", "start_index?"],
      "prefers_over": "WebFetch (native)"
    }
  ],

  "relationships": [
    {
      "type": "replaces",
      "from": "read",
      "to": ["bash:cat", "bash:head", "bash:tail", "bash:less"],
      "rationale": "Native Read tool is optimized with proper permissions and better formatting"
    },
    {
      "type": "replaces",
      "from": "write",
      "to": ["bash:echo >", "bash:cat > EOF", "bash:printf"],
      "rationale": "Native Write tool ensures atomic writes and proper error handling"
    },
    {
      "type": "replaces",
      "from": "edit",
      "to": ["bash:sed", "bash:awk", "bash:perl -pie"],
      "rationale": "Native Edit tool provides safer, more reliable string replacement"
    },
    {
      "type": "replaces",
      "from": "glob",
      "to": ["bash:find -name", "bash:ls"],
      "rationale": "Native Glob tool is faster and provides consistent sorting"
    },
    {
      "type": "replaces",
      "from": "grep",
      "to": ["bash:grep", "bash:rg", "bash:find | grep"],
      "rationale": "Native Grep tool has optimized permissions and better output formatting"
    },
    {
      "type": "used_by",
      "from": "skill_property_data",
      "to": ["agent_listing_browser", "agent_map_analyzer", "agent_image_assessor"]
    },
    {
      "type": "used_by",
      "from": "skill_state_management",
      "to": ["agent_listing_browser", "agent_map_analyzer", "agent_image_assessor"]
    },
    {
      "type": "used_by",
      "from": "skill_listing_extraction",
      "to": ["agent_listing_browser"]
    },
    {
      "type": "used_by",
      "from": "skill_map_analysis",
      "to": ["agent_map_analyzer"]
    },
    {
      "type": "used_by",
      "from": "skill_image_assessment",
      "to": ["agent_image_assessor"]
    },
    {
      "type": "used_by",
      "from": "skill_exterior_assessment",
      "to": ["agent_image_assessor"]
    },
    {
      "type": "used_by",
      "from": "skill_inspection_standards",
      "to": ["agent_image_assessor"]
    },
    {
      "type": "used_by",
      "from": "skill_arizona_context",
      "to": ["agent_map_analyzer", "agent_image_assessor"]
    },
    {
      "type": "used_by",
      "from": "skill_scoring",
      "to": ["agent_map_analyzer", "agent_image_assessor", "phx_home_analyzer"]
    },
    {
      "type": "spawns",
      "from": "cmd_analyze_property",
      "to": ["agent_listing_browser", "agent_map_analyzer", "agent_image_assessor"]
    },
    {
      "type": "spawns",
      "from": "task",
      "to": ["agent_listing_browser", "agent_map_analyzer", "agent_image_assessor"]
    },
    {
      "type": "requires",
      "from": "agent_listing_browser",
      "to": ["skill_property_data", "skill_state_management", "skill_listing_extraction", "skill_kill_switch"]
    },
    {
      "type": "requires",
      "from": "agent_map_analyzer",
      "to": ["skill_property_data", "skill_state_management", "skill_map_analysis", "skill_arizona_context", "skill_scoring"]
    },
    {
      "type": "requires",
      "from": "agent_image_assessor",
      "to": ["skill_property_data", "skill_state_management", "skill_image_assessment", "skill_exterior_assessment", "skill_inspection_standards", "skill_arizona_context", "skill_scoring"]
    },
    {
      "type": "not_when",
      "from": "task",
      "condition": "simple single-step task main agent can handle",
      "rationale": "Task tool is for complex multi-round operations, not trivial tasks"
    },
    {
      "type": "prefers",
      "from": "mcp_fetch",
      "to": "webfetch",
      "rationale": "MCP fetch tool may have fewer restrictions if available"
    },
    {
      "type": "prefers",
      "from": "edit",
      "to": "write",
      "condition": "file already exists",
      "rationale": "Always prefer editing existing files over creating new ones"
    },
    {
      "type": "provides",
      "from": "skill_property_data",
      "to": ["data loading", "validation", "normalization", "atomic writes"]
    },
    {
      "type": "provides",
      "from": "skill_county_assessor",
      "to": ["lot_sqft", "year_built", "garage_spaces", "has_pool", "livable_sqft"]
    },
    {
      "type": "provides",
      "from": "extract_images",
      "to": ["downloaded images", "image_manifest.json", "extraction_state.json", "hash_index.json"]
    },
    {
      "type": "provides",
      "from": "phx_home_analyzer",
      "to": ["phx_homes_ranked.csv", "property scores", "tier assignments"]
    }
  ],

  "agent_skill_mapping": {
    "listing-browser": {
      "model": "haiku",
      "skills": ["property-data", "state-management", "listing-extraction", "kill-switch"],
      "purpose": "Extract listing data and images from Zillow/Redfin/Realtor.com",
      "outputs": ["hoa_fee", "beds", "baths", "price", "description", "images"]
    },
    "map-analyzer": {
      "model": "haiku",
      "skills": ["property-data", "state-management", "map-analysis", "arizona-context", "scoring"],
      "purpose": "Geographic analysis for Section A (Location) scoring",
      "outputs": ["school_rating", "safety_score", "distances", "orientation", "Section A points"]
    },
    "image-assessor": {
      "model": "sonnet",
      "skills": ["property-data", "state-management", "image-assessment", "exterior-assessment", "inspection-standards", "arizona-context", "scoring"],
      "purpose": "Visual analysis for Section C (Interior) scoring and exterior condition assessment",
      "outputs": [
        "Section C scores (7 categories, 190pts)",
        "roof_visual_condition",
        "pool_equipment_age_visual",
        "hvac_age_visual_estimate",
        "overall_assessment"
      ]
    }
  },

  "common_mistakes": {
    "file_operations": [
      {
        "mistake": "Using bash cat instead of Read tool",
        "correct": "Always use Read tool for reading files",
        "example_wrong": "bash: cat file.txt",
        "example_right": "Read: file_path='C:\\path\\to\\file.txt'"
      },
      {
        "mistake": "Using bash grep instead of Grep tool",
        "correct": "Always use Grep tool for searching file contents",
        "example_wrong": "bash: grep 'pattern' file.txt",
        "example_right": "Grep: pattern='pattern', path='C:\\path\\to\\file.txt'"
      },
      {
        "mistake": "Using bash find instead of Glob tool",
        "correct": "Always use Glob tool for finding files by pattern",
        "example_wrong": "bash: find . -name '*.py'",
        "example_right": "Glob: pattern='**/*.py'"
      },
      {
        "mistake": "Using bash sed/awk instead of Edit tool",
        "correct": "Always use Edit tool for string replacement",
        "example_wrong": "bash: sed -i 's/old/new/' file.txt",
        "example_right": "Edit: old_string='old', new_string='new'"
      },
      {
        "mistake": "Using bash echo for file I/O instead of Write tool",
        "correct": "Always use Write tool for writing files",
        "example_wrong": "bash: echo 'content' > file.txt",
        "example_right": "Write: file_path='C:\\path\\to\\file.txt', content='content'"
      }
    ],
    "tool_selection": [
      {
        "mistake": "Using Task tool for simple single-step operations",
        "correct": "Task is for complex multi-round tasks only",
        "when_to_use": "3+ step tasks requiring multiple rounds of investigation",
        "when_not_to_use": "Simple tasks main agent can handle in one response"
      },
      {
        "mistake": "Writing new files instead of editing existing ones",
        "correct": "ALWAYS prefer Edit over Write for existing files",
        "rationale": "Editing is safer and preserves structure"
      },
      {
        "mistake": "Calculating property hash manually",
        "correct": "ALWAYS use address_folder_lookup.json to find image folders",
        "rationale": "Hash algorithm might change, lookup is canonical source"
      },
      {
        "mistake": "Using Playwright MCP for Zillow/Redfin",
        "correct": "Use scripts/extract_images.py stealth browsers for Zillow/Redfin",
        "rationale": "PerimeterX anti-bot will block Playwright, use nodriver/curl_cffi"
      }
    ],
    "validation": [
      {
        "mistake": "Not validating property data after loading",
        "correct": "Always use PropertyValidator from property-data skill",
        "example": "result = PropertyValidator().validate(data); if result.is_valid: ..."
      },
      {
        "mistake": "Forgetting kill-switch validation before expensive operations",
        "correct": "Run kill-switch check early to avoid wasting resources on non-qualifying properties",
        "example": "Load kill-switch skill, validate before Phase 1"
      }
    ],
    "data_operations": [
      {
        "mistake": "Overwriting entire enrichment_data.json instead of merging",
        "correct": "Always merge updates, use atomic write pattern (.tmp then rename)",
        "example": "prop.update(updates); write to .tmp; os.replace()"
      },
      {
        "mistake": "Using relative paths",
        "correct": "ALWAYS use absolute paths for all file operations",
        "rationale": "Working directory may change between operations"
      },
      {
        "mistake": "Not distinguishing null vs 0 for hoa_fee",
        "correct": "null = unknown, 0 = confirmed no HOA, positive = HOA amount",
        "importance": "HOA is a kill-switch field, must be precise"
      }
    ],
    "websearch": [
      {
        "mistake": "Forgetting Sources section after WebSearch",
        "correct": "MANDATORY: Include 'Sources:' section with markdown links after search",
        "example": "Sources:\n- [Title](https://url.com)"
      },
      {
        "mistake": "Using wrong year in search queries",
        "correct": "Use 2025 for current information (not 2024)",
        "example_wrong": "search: 'React documentation 2024'",
        "example_right": "search: 'React documentation 2025'"
      }
    ],
    "state_management": [
      {
        "mistake": "Not checking extraction_state.json before starting work",
        "correct": "Always triage: check if property already completed or failed",
        "mandatory_steps": [
          "Read extraction_state.json",
          "Check completed_properties",
          "Check failed_properties and retry_count",
          "Skip if already done or max retries exceeded"
        ]
      },
      {
        "mistake": "Marking task completed when it actually failed or is partial",
        "correct": "Only mark completed when FULLY accomplished, including tests passing",
        "examples": [
          "Tests failing? Keep in_progress",
          "Implementation partial? Keep in_progress",
          "Encountered errors? Keep in_progress",
          "Missing files? Keep in_progress"
        ]
      }
    ],
    "git_operations": [
      {
        "mistake": "Using --no-verify to bypass pre-commit hooks",
        "correct": "NEVER skip hooks unless explicitly requested by user",
        "consequence": "Violates TIER 0 protocol, corrupts code quality"
      },
      {
        "mistake": "Force pushing to main/master",
        "correct": "Warn user if they request force push to main/master",
        "consequence": "Can destroy team's work"
      },
      {
        "mistake": "Amending other developers' commits",
        "correct": "Check HEAD commit authorship before amending, only amend your own",
        "example": "git log -1 --format='%an %ae' to check author"
      }
    ]
  },

  "data_flow": {
    "phase_0": {
      "name": "County Data Extraction",
      "script": "scripts/extract_county_data.py",
      "skill": "county-assessor",
      "inputs": ["MARICOPA_ASSESSOR_TOKEN", "phx_homes.csv"],
      "outputs": ["lot_sqft", "year_built", "garage_spaces", "has_pool", "livable_sqft"],
      "destination": "enrichment_data.json",
      "authoritative_for": ["lot_sqft", "year_built", "garage_spaces"]
    },
    "phase_1_listing": {
      "name": "Listing Data Extraction",
      "agent": "listing-browser",
      "script": "scripts/extract_images.py",
      "skills": ["property-data", "state-management", "listing-extraction", "kill-switch"],
      "inputs": ["target_address", "extraction_state.json"],
      "outputs": ["hoa_fee", "beds", "baths", "price", "description", "images"],
      "destination": "enrichment_data.json, property_images/processed/{hash}/",
      "kill_switch_check": "Validate HOA, beds, baths early"
    },
    "phase_1_map": {
      "name": "Geographic Analysis",
      "agent": "map-analyzer",
      "skills": ["property-data", "state-management", "map-analysis", "arizona-context", "scoring"],
      "inputs": ["target_address", "extraction_state.json"],
      "outputs": ["school_rating", "safety_score", "distances", "orientation", "Section A points"],
      "destination": "enrichment_data.json"
    },
    "phase_2": {
      "name": "Image Assessment",
      "agent": "image-assessor",
      "skills": ["property-data", "state-management", "image-assessment", "exterior-assessment", "inspection-standards", "arizona-context", "scoring"],
      "inputs": ["address_folder_lookup.json", "year_built", "has_pool"],
      "outputs": [
        "Section C scores (7 categories)",
        "roof_visual_condition",
        "pool_equipment_age_visual",
        "hvac_age_visual_estimate",
        "overall_assessment"
      ],
      "destination": "enrichment_data.json"
    },
    "phase_3": {
      "name": "Scoring and Synthesis",
      "script": "scripts/phx_home_analyzer.py",
      "skills": ["property-data", "kill-switch", "scoring"],
      "inputs": ["phx_homes.csv", "enrichment_data.json"],
      "outputs": ["phx_homes_ranked.csv", "total_score", "tier"],
      "scoring": {
        "Section A": "230 pts (Location)",
        "Section B": "180 pts (Lot/Systems)",
        "Section C": "190 pts (Interior)",
        "Total": "600 pts max"
      }
    },
    "phase_4": {
      "name": "Deal Sheet Generation",
      "script": "scripts/deal_sheets/generator.py",
      "skill": "deal-sheets",
      "inputs": ["phx_homes_ranked.csv", "enrichment_data.json"],
      "outputs": ["HTML deal sheets", "index.html"],
      "destination": "reports/deal_sheets/"
    }
  },

  "best_practices": {
    "file_operations": [
      "Always use absolute paths, never relative",
      "Use Read, Write, Edit tools instead of bash equivalents",
      "Use Glob for file pattern matching, not bash find",
      "Use Grep for content search, not bash grep",
      "Read existing file before Writing to it",
      "Prefer Edit over Write for existing files"
    ],
    "data_integrity": [
      "Always use atomic writes (write to .tmp, then rename)",
      "Merge updates, don't overwrite entire objects",
      "Normalize addresses using full_address as canonical key",
      "Distinguish null (unknown) vs 0 (confirmed zero)",
      "Validate data with PropertyValidator before processing"
    ],
    "state_management": [
      "Always check extraction_state.json before starting work",
      "Triage: skip if completed or max retries exceeded",
      "Update phase status as work progresses",
      "Mark completed only when FULLY accomplished"
    ],
    "agent_usage": [
      "Use Task tool for complex multi-step operations only",
      "Load appropriate skills for domain expertise",
      "Check agent isn't already running before spawning",
      "Use correct model (Haiku for speed, Sonnet for quality)"
    ],
    "git_operations": [
      "NEVER bypass pre-commit hooks (--no-verify)",
      "Check authorship before amending commits",
      "Warn on force push to main/master",
      "Only commit when explicitly requested"
    ],
    "web_operations": [
      "Use stealth browsers (scripts/extract_images.py) for anti-bot sites",
      "Never use Playwright MCP for Zillow/Redfin (PerimeterX blocks it)",
      "Include Sources section after WebSearch (MANDATORY)",
      "Use correct year (2025) in search queries"
    ]
  },

  "meta": {
    "project": "PHX Houses Dec 2025",
    "purpose": "First-time home buyer analysis for Phoenix metropolitan area",
    "target_buyer": "Max $4k/month payment, 4+ bed, 2+ bath, 2-car garage, 7k-15k sqft lot, NO HOA, city sewer, pre-2024 builds",
    "scoring_system": "600 points max: Location (230), Lot/Systems (180), Interior (190)",
    "tiers": {
      "Unicorn": ">480 points",
      "Contender": "360-480 points",
      "Pass": "<360 points"
    },
    "kill_switch": {
      "HARD": ["hoa_fee=0 or null", "beds>=4", "baths>=2"],
      "SOFT": ["city sewer (2.5)", "year_built<2024 (2.0)", "garage>=2 (1.5)", "lot 7k-15k (1.0)"],
      "verdict": "FAIL if any HARD fails OR severity>=3.0"
    }
  }
}
